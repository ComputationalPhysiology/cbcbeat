# Mathematical simulations of ligand-gated and cell-type specific effects on the action potential of human atrium
# 
# ABSTRACT: In the mammalian heart, myocytes and fibroblasts can communicate via
# gap junction, or connexin-mediated current flow. Some of the effects of this
# electrotonic coupling on the action potential waveform of the human ventricular
# myocyte have been analyzed in detail. The present study employs a recently
# developed mathematical model of the human atrial myocyte to investigate the
# consequences of this heterogeneous cell-cell interaction on the action
# potential of the human atrium. Two independent physiological processes which
# alter the physiology of the human atrium have been studied. i) The effects of
# the autonomic transmitter acetylcholine on the atrial action potential have
# been investigated by inclusion of a time-independent, acetylcholine-activated
# K+ current in this mathematical model of the atrial myocyte. ii) A
# non-selective cation current which is activated by natriuretic peptides has
# been incorporated into a previously published mathematical model of the cardiac
# fibroblast. These results identify subtle effects of acetylcholine, which arise
# from the nonlinear interactions between ionic currents in the human atrial
# myocyte. They also illustrate marked alterations in the action potential
# waveform arising from fibroblast-myocyte source-sink principles when the
# natriuretic peptide-mediated cation conductance is activated. Additional
# calculations also illustrate the effects of simultaneous activation of both of
# these cell-type specific conductances within the atrial myocardium. This study
# provides a basis for beginning to assess the utility of mathematical modeling
# in understanding detailed cell-cell interactions within the complex paracrine
# environment of the human atrial myocardium.
# 
# The complete original paper reference is cited below:
# 
# Mathematical simulations of ligand-gated and cell-type specific effects on the
# action potential of human atrium, Mary M. Maleckara, Joseph L. Greensteina,
# Natalia A. Trayanova and Wayne R. Giles, 2009,Progress in Biophysics and
# Molecular BiologyPubMed ID: 19186188
# 

# gotran file generated by cellml2gotran from maleckar_greenstein_trayanova_giles_2009.cellml

parameters("Sodium current",
           P_Na = ScalarParam(0.0018, unit="nl*s**-1"))

states("Sodium current", "m gate",
       m = 0.003289)

states("Sodium current", "H1 gate",
       h1 = 0.877202)

states("Sodium current", "H2 gate",
       h2 = 0.873881)

parameters("L_type Ca channel",
           g_Ca_L = ScalarParam(6.75, unit="nS"),
           E_Ca_app = ScalarParam(60, unit="mV"),
           k_Ca = ScalarParam(0.025, unit="mM"))

states("L_type Ca channel", "d_L gate",
       d_L = 0.000014)

states("L_type Ca channel", "f_L1 gate",
       f_L1 = 0.998597)

states("L_type Ca channel", "f_L2 gate",
       f_L2 = 0.998586)

parameters("Ca independent transient outward K current",
           g_t = ScalarParam(8.25, unit="nS"))

states("Ca independent transient outward K current", "r gate",
       r = 0.001089)

states("Ca independent transient outward K current", "s gate",
       s = 0.948597)

parameters("Ultra rapid K current",
           g_kur = ScalarParam(2.25, unit="nS"))

states("Ultra rapid K current", "Aur gate",
       a_ur = 0.000367)

states("Ultra rapid K current", "Iur gate",
       i_ur = 0.96729)

parameters("Inward rectifier",
           g_K1 = ScalarParam(3.1, unit="nS"))

states("Delayed rectifier K currents", "n gate",
       n = 0.004374)

states("Delayed rectifier K currents", "Pa gate",
       pa = 0.000053)

parameters("Background currents",
           g_B_Na = ScalarParam(0.060599, unit="nS"),
           g_B_Ca = ScalarParam(0.078681, unit="nS"))

parameters("Sodium potassium pump",
           K_NaK_K = ScalarParam(1, unit="mM"),
           i_NaK_max = ScalarParam(68.55, unit="pA"),
           pow_K_NaK_Na_15 = ScalarParam(36.4829, unit="mM**1.5"))

parameters("Sarcolemmal calcium pump current",
           i_CaP_max = ScalarParam(4, unit="pA"),
           k_CaP = ScalarParam(0.0002, unit="mM"))

parameters("Na Ca ion exchanger current",
           K_NaCa = ScalarParam(0.0374842, unit="pA*mM**-4"),
           d_NaCa = ScalarParam(0.0003, unit="mM**-4"),
           gamma_Na = 0.45)

parameters("ACh dependent K current",
           ACh = ScalarParam(1e-24, unit="mM"))

states("Intracellular Ca buffering",
       O_C = 0.026766,
       O_TC = 0.012922,
       O_TMgC = 0.190369,
       O_TMgMg = 0.714463,
       O = 1.38222)

parameters("Intracellular Ca buffering",
           Mg_i = ScalarParam(2.5, unit="mM"))

states("Ca handling by the SR",
       F1 = 0.470055,
       F2 = 0.002814,
       O_Calse = 0.431547,
       Ca_up = ScalarParam(0.649195, unit="mM"),
       Ca_rel = ScalarParam(0.632613, unit="mM"))

parameters("Ca handling by the SR",
           I_up_max = ScalarParam(2800, unit="pA"),
           k_cyca = ScalarParam(0.0003, unit="mM"),
           k_srca = ScalarParam(0.5, unit="mM"),
           k_xcs = 0.4,
           alpha_rel = ScalarParam(200000, unit="pA*mM**-1"),
           Vol_up = ScalarParam(0.0003969, unit="nl"),
           Vol_rel = ScalarParam(0.0000441, unit="nl"),
           r_recov = ScalarParam(0.815, unit="s**-1"),
           tau_tr = ScalarParam(0.01, unit="s"),
           k_rel_i = ScalarParam(0.0003, unit="mM"),
           k_rel_d = ScalarParam(0.003, unit="mM"))

parameters("Delayed rectifier K currents",
           g_Ks = ScalarParam(1, unit="nS"),
           g_Kr = ScalarParam(0.5, unit="nS"))

states("Cleft space ion concentrations",
       Ca_c = ScalarParam(1.815768, unit="mM"),
       K_c = ScalarParam(5.560224, unit="mM"),
       Na_c = ScalarParam(130.022096, unit="mM"))

parameters("Cleft space ion concentrations",
           Vol_c = ScalarParam(0.000800224, unit="nl"),
           tau_Na = ScalarParam(14.3, unit="s"),
           tau_K = ScalarParam(10, unit="s"),
           tau_Ca = ScalarParam(24.7, unit="s"),
           Na_b = ScalarParam(130, unit="mM"),
           Ca_b = ScalarParam(1.8, unit="mM"),
           K_b = ScalarParam(5.4, unit="mM"))

states("Membrane",
       V = ScalarParam(-74.031982, unit="mV"))

parameters("Membrane",
           R = ScalarParam(8314, unit="mJ*mole**-1*K**-1"),
           T = ScalarParam(306.15, unit="K"),
           F = ScalarParam(96487, unit="C*mole**-1"),
           Cm = ScalarParam(50, unit="nF"),
           stim_offset = ScalarParam(1, unit="s"),
           stim_period = ScalarParam(1, unit="s"),
           stim_duration = ScalarParam(0.006, unit="s"),
           stim_amplitude = ScalarParam(-15, unit="pA*nF**-1"))

states("Intracellular ion concentrations",
       K_i = ScalarParam(129.485991, unit="mM"),
       Na_i = ScalarParam(8.516766, unit="mM"),
       Ca_i = ScalarParam(6.5e-5, unit="mM"),
       Ca_d = ScalarParam(7.1e-5, unit="mM"))

parameters("Intracellular ion concentrations",
           phi_Na_en = ScalarParam(0, unit="pA"),
           Vol_i = ScalarParam(0.005884, unit="nl"),
           Vol_d = ScalarParam(0.00011768, unit="nl"),
           tau_di = ScalarParam(0.01, unit="s"))

component("Sodium current")
E_Na = R*T/F*log(Na_c/Na_i) # mV
i_Na = P_Na*m*m*m*(0.9*h1 + 0.1*h2)*Na_c*V*F*F/(R*T)*(exp((V - E_Na)*F/(R*T)) - 1)/(exp(V*F/(R*T)) - 1) # pA

component("Sodium current", "m gate")
m_factor = (V + 25.57)/28.8
m_infinity = 1/(1 + exp((V + 27.12)/-8.21))
tau_m = 0.000042*exp(-m_factor*m_factor) + 0.000024 # s
dm_dt = (m_infinity - m)/tau_m

component("Sodium current", "H1 gate")
h_infinity = 1/(1 + exp((V + 63.6)/5.3))
h_factor = 1/(1 + exp((V + 35.1)/3.2))
tau_h1 = 0.03*h_factor + 0.0003 # s
dh1_dt = (h_infinity - h1)/tau_h1

component("Sodium current", "H2 gate")
tau_h2 = 0.12*h_factor + 0.003 # s
dh2_dt = (h_infinity - h2)/tau_h2

component("L_type Ca channel")
f_Ca = Ca_d/(Ca_d + k_Ca)
i_Ca_L = g_Ca_L*d_L*(f_Ca*f_L1 + (1 - f_Ca)*f_L2)*(V - E_Ca_app) # pA

component("L_type Ca channel", "d_L gate")
d_L_infinity = 1/(1 + exp((V + 9)/-5.8))
d_L_factor = (V + 35)/30
tau_d_L = 0.0027*exp(-d_L_factor*d_L_factor) + 0.002 # s
dd_L_dt = (d_L_infinity - d_L)/tau_d_L

component("L_type Ca channel", "f_L1 gate")
f_L_infinity = 1/(1 + exp((V + 27.4)/7.1))
f_L_factor = V + 40 # mV
tau_f_L1 = 0.161*exp(-f_L_factor*f_L_factor/14.4/14.4) + 0.01 # s
df_L1_dt = (f_L_infinity - f_L1)/tau_f_L1

component("L_type Ca channel", "f_L2 gate")
tau_f_L2 = 1.3323*exp(-f_L_factor*f_L_factor/14.2/14.2) + 0.0626 # s
df_L2_dt = (f_L_infinity - f_L2)/tau_f_L2

component("Ca independent transient outward K current")
E_K = R*T/F*log(K_c/K_i) # mV
i_t = g_t*r*s*(V - E_K) # pA

component("Ca independent transient outward K current", "r gate")
r_infinity = 1/(1 + exp((V - 1)/-11))
tau_r = 0.0035*exp(-V*V/30/30) + 0.0015 # s
dr_dt = (r_infinity - r)/tau_r

component("Ca independent transient outward K current", "s gate")
s_infinity = 1/(1 + exp((V + 40.5)/11.5))
s_factor = (V + 52.45)/15.8827
tau_s = 0.025635*exp(-s_factor*s_factor) + 0.01414 # s
ds_dt = (s_infinity - s)/tau_s

component("Ultra rapid K current")
i_Kur = g_kur*a_ur*i_ur*(V - E_K) # pA

component("Ultra rapid K current", "Aur gate")
a_ur_infinity = 1/(1 + exp(-(V + 6)/8.6))
tau_a_ur = 0.009/(1 + exp((V + 5)/12)) + 0.0005 # s
da_ur_dt = (a_ur_infinity - a_ur)/tau_a_ur

component("Ultra rapid K current", "Iur gate")
i_ur_infinity = 1/(1 + exp((V + 7.5)/10))
tau_i_ur = 0.59/(1 + exp((V + 60)/10)) + 3.05 # s
di_ur_dt = (i_ur_infinity - i_ur)/tau_i_ur

component("Inward rectifier")
i_K1 = g_K1*(K_c/1)**0.4457*(V - E_K)/(1 + exp(1.5*(V - E_K + 3.6)*F/(R*T))) # pA

component("Delayed rectifier K currents", "n gate")
n_infinity = 1/(1 + exp((V - 19.9)/-12.7))
n_factor = (V - 20)/20
tau_n = 0.7 + 0.4*exp(-n_factor*n_factor) # s
dn_dt = (n_infinity - n)/tau_n

component("Delayed rectifier K currents", "Pa gate")
p_a_infinity = 1/(1 + exp((V + 15)/-6))
pa_factor = (V + 20.1376)/22.1996
tau_pa = 0.03118 + 0.21718*exp(-pa_factor*pa_factor) # s
dpa_dt = (p_a_infinity - pa)/tau_pa

component("Delayed rectifier K currents", "Pi gate")
pip = 1/(1 + exp((V + 55)/24))

component("Background currents")
i_B_Na = g_B_Na*(V - E_Na) # pA
E_Ca = R*T/(2*F)*log(Ca_c/Ca_i) # mV
i_B_Ca = g_B_Ca*(V - E_Ca) # pA

component("Sodium potassium pump")
pow_Na_i_15 = Na_i**1.5 # mM**1.5
i_NaK = i_NaK_max*K_c/(K_c + K_NaK_K)*pow_Na_i_15/(pow_Na_i_15 + pow_K_NaK_Na_15)*(V + 150)/(V + 200) # pA

component("Sarcolemmal calcium pump current")
i_CaP = i_CaP_max*Ca_i/(Ca_i + k_CaP) # pA

component("Na Ca ion exchanger current")
i_NaCa = K_NaCa*(Na_i*Na_i*Na_i*Ca_c*exp(F*V*gamma_Na/(R*T)) - Na_c*Na_c*Na_c*Ca_i*exp((gamma_Na - 1)*V*F/(R*T)))/(1 + d_NaCa*(Na_c*Na_c*Na_c*Ca_i + Na_i*Na_i*Na_i*Ca_c)) # pA

component("ACh dependent K current")
i_KACh = 10/(1 + 9.13652*1**0.477811/ACh**0.477811)*(0.0517 + 0.4516/(1 + exp((V + 59.53)/17.18)))*(V - E_K)*Cm # pA

component("Intracellular Ca buffering")
J_O_C = 200000*Ca_i*(1 - O_C) - 476*O_C # s**-1
J_O_TC = 78400*Ca_i*(1 - O_TC) - 392*O_TC # s**-1
J_O_TMgC = 200000*Ca_i*(1 - O_TMgC - O_TMgMg) - 6.6*O_TMgC # s**-1
J_O_TMgMg = 2000*Mg_i*(1 - O_TMgC - O_TMgMg) - 666*O_TMgMg # s**-1
dO_C_dt = J_O_C
dO_TC_dt = J_O_TC
dO_TMgC_dt = J_O_TMgC
dO_TMgMg_dt = J_O_TMgMg
J_O = 0.08*J_O_TC + 0.16*J_O_TMgC + 0.045*J_O_C # s**-1
dO_dt = J_O

component("Ca handling by the SR")
r_Ca_d_term = Ca_d/(Ca_d + k_rel_d)
r_Ca_i_term = Ca_i/(Ca_i + k_rel_i)
r_Ca_d_factor = r_Ca_d_term*r_Ca_d_term*r_Ca_d_term*r_Ca_d_term
r_Ca_i_factor = r_Ca_i_term*r_Ca_i_term*r_Ca_i_term*r_Ca_i_term
r_act = 203.8*(r_Ca_i_factor + r_Ca_d_factor) # s**-1
r_inact = 33.96 + 339.6*r_Ca_i_factor # s**-1
dF1_dt = r_recov*(1 - F1 - F2) - r_act*F1
dF2_dt = r_act*F1 - r_inact*F2
i_rel_f2 = F2/(F2 + 0.25)
i_rel_factor = i_rel_f2*i_rel_f2
i_rel = alpha_rel*i_rel_factor*(Ca_rel - Ca_i) # pA
i_up = I_up_max*(Ca_i/k_cyca - k_xcs*k_xcs*Ca_up/k_srca)/((Ca_i + k_cyca)/k_cyca + k_xcs*(Ca_up + k_srca)/k_srca) # pA
i_tr = (Ca_up - Ca_rel)*2*Vol_rel*F/tau_tr # pA
J_O_Calse = 480*Ca_rel*(1 - O_Calse) - 400*O_Calse # s**-1
dO_Calse_dt = J_O_Calse
dCa_up_dt = (i_up - i_tr)/(2*Vol_up*F)
dCa_rel_dt = (i_tr - i_rel)/(2*Vol_rel*F) - 31*J_O_Calse

component("Delayed rectifier K currents")
i_Ks = g_Ks*n*(V - E_K) # pA
i_Kr = g_Kr*pa*pip*(V - E_K) # pA

component("Cleft space ion concentrations")
dCa_c_dt = (Ca_b - Ca_c)/tau_Ca + (i_Ca_L + i_B_Ca + i_CaP - 2*i_NaCa)/(2*Vol_c*F)
dK_c_dt = (K_b - K_c)/tau_K + (i_t + i_Kur + i_K1 + i_Ks + i_Kr - 2*i_NaK)/(Vol_c*F)
dNa_c_dt = (Na_b - Na_c)/tau_Na + (i_Na + i_B_Na + 3*i_NaCa + 3*i_NaK + phi_Na_en)/(Vol_c*F)

component("Membrane")
past = floor(time/stim_period)*stim_period # s
i_Stim = Conditional(And(Ge(time - past, stim_offset), Le(time - past, stim_offset + stim_duration), ), stim_amplitude, 0) # pA*nF**-1
I = (i_Na + i_Ca_L + i_t + i_Kur + i_K1 + i_Kr + i_Ks + i_B_Na + i_B_Ca + i_NaK + i_CaP + i_NaCa + i_KACh)/Cm + i_Stim # pA*nF**-1
dV_dt = -I*1000
Q_tot = 0.05*V # mV

component("Intracellular ion concentrations")
dK_i_dt = -(i_t + i_Kur + i_K1 + i_Ks + i_Kr - 2*i_NaK + i_Stim*Cm)/(Vol_i*F)
dNa_i_dt = -(i_Na + i_B_Na + 3*i_NaCa + 3*i_NaK + phi_Na_en)/(Vol_i*F)
i_di = (Ca_d - Ca_i)*2*Vol_d*F/tau_di # pA
dCa_i_dt = -(i_B_Ca + i_CaP + i_up - (i_di + i_rel + 2*i_NaCa))/(2*Vol_i*F) - 1*J_O
dCa_d_dt = -(i_Ca_L + i_di)/(2*Vol_d*F)

