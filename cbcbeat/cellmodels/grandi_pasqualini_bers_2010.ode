# A novel computational model of the human ventricular action potential and Ca transient
#
#
# ABSTRACT: We have developed a detailed mathematical model for Ca handling and
# ionic currents in the human ventricular myocyte. Our aims were to: (1) simulate
# basic excitation-contraction coupling phenomena; (2) use realistic repolarizing
# K current densities; (3) reach steady-state. The model relies on the framework
# of the rabbit myocyte model previously developed by our group, with
# subsarcolemmal and junctional compartments where ion channels sense higher [Ca]
# vs. bulk cytosol. Ion channels and transporters have been modeled on the basis
# of the most recent experimental data from human ventricular myocytes. Rapidly
# and slowly inactivating components of I(to) have been formulated to
# differentiate between endocardial and epicardial myocytes. Transmural gradients
# of Ca handling proteins and Na pump were also simulated. The model has been
# validated against a wide set of experimental data including action potential
# duration (APD) adaptation and restitution, frequency-dependent increase in Ca
# transient peak and [Na](i). Interestingly, Na accumulation at fast heart rate
# is a major determinant of APD shortening, via outward shifts in Na pump and
# Na-Ca exchange currents. We investigated the effects of blocking K currents on
# APD and repolarization reserve: I(Ks) block does not affect the former and
# slightly reduces the latter; I(K1) blockade modestly increases APD and more
# strongly reduces repolarization reserve; I(Kr) blockers significantly prolong
# APD, an effect exacerbated as pacing frequency is decreased, in good agreement
# with experimental results in human myocytes. We conclude that this model
# provides a useful framework to explore excitation-contraction coupling
# mechanisms and repolarization abnormalities at the single myocyte level.
#
# The original paper reference is cited below:
#
# A novel computational model of the human ventricular action potential and Ca
# transient, Eleonora Grandi, Francesco S. Pasqualini, Donald M. Bers,
# 2010,Journal of Molecular and Cellular Cardiology, volume 48, 112-121.PubMed
# ID: 19835882
#

# gotran file generated by cellml2gotran from grandi_pasqualini_bers_2010.cellml

parameters("Geometry",
           cellLength = 100,
           cellRadius = 10.25,
           junctionLength = 160e-3,
           junctionRadius = 15e-3,
           distSLcyto = 0.45,
           distJuncSL = 0.5,
           Fjunc = 0.11,
           Fjunc_CaL = 0.9,
           )

states("I_Na",
       m = 0.003793087414436,
       h = 0.626221949492493,
       j = 0.624553572490432)

parameters("I_Na",
           GNa = 23,
           )

parameters("I_NaBK",
           GNaB = 0.597e-3,
           )

parameters("I_NaK",
           IbarNaK = 1*1.8,
           KmNaip = 11,
           KmKo = 1.5,
           Q10NaK = 1.63,
           Q10KmNai = 1.39,
           )

states("I_Kr",
       x_kr = 0.0210022533039071)

parameters("I_Kp",
           gkp = 0.002
           )

states("I_Ks",
       x_ks = 0.00428016666258923)

parameters("I_Ks",
           pNaK = 0.01833
           )

states("I_to",
       x_to_s = 0.000440445885642567,
       y_to_s = 0.785115828275182,
       x_to_f = 0.000440438103758954,
       y_to_f = 0.999995844038706)

parameters("I_to",
           epi = 1,
           )

parameters("I_ClCa",
           GClCa = 0.5*0.109625,
           GClB = 1*9e-3,
           KdClCa = 100e-3,
           )

states("I_Ca",
       d = 2.92407183949469e-6,
       f = 0.995135796703515,
       f_Ca_Bj = 0.0246760872105795,
       f_Ca_Bsl = 0.0152723084239416)

parameters("I_Ca",
           pNa = 0.5*1.5e-8,
           pCa = 0.5*5.4e-4,
           pK = 0.5*2.7e-7,
           Q10CaL = 1.8,
           )

parameters("I_NCX",
           IbarNCX = 1*4.5,
           KmCai = 3.59e-3,
           KmCao = 1.3,
           KmNai = 12.29,
           KmNao = 87.5,
           ksat = 0.32,
           nu = 0.27,
           Kdact = 0.15e-3,
           Q10NCX = 1.57,
           )

parameters("I_PCa",
           Q10SLCaP = 2.35,
           IbarSLCaP = 0.0673,
           KmPCa = 0.5e-3,
           )

parameters("I_CaBK",
           GCaB = 5.513e-4,
           )

states("SR Fluxes",
       Ry_Rr = ScalarParam(0.890806040818203, unit="mmole*l**-1"),
       Ry_Ro = ScalarParam(7.40481128853622e-7, unit="mmole*l**-1"),
       Ry_Ri = ScalarParam(9.07666168960848e-8, unit="mmole*l**-1"))

parameters("SR Fluxes",
           MaxSR = 15,
           MinSR = 1,
           Q10SRCaP = 2.6,
           Vmax_SRCaP = 5.3114e-3,
           Kmf = 0.246e-3,
           Kmr = 1.7,
           hillSRCaP = 1.787,
           ks = 25,
           koCa = 10,
           kom = 0.06,
           kiCa = 0.5,
           kim = 0.005,
           ec50SR = 0.45,
           )

states("Na Buffers",
       Na_Bj = ScalarParam(3.4543773303328, unit="mmole*l**-1"),
       Na_Bsl = ScalarParam(0.753740951477775, unit="mmole*l**-1"))

parameters("Na Buffers",
           Bmax_Naj = 7.561,
           Bmax_Nasl = 1.65,
           koff_na = 1e-3,
           kon_na = 0.1e-3,
           )

states("Cytosolic Ca Buffers",
       Tn_CL = ScalarParam(0.00893455096919132, unit="mmole*l**-1"),
       Tn_CHc = ScalarParam(0.117412025936615, unit="mmole*l**-1"),
       Tn_CHm = ScalarParam(0.0106160166692932, unit="mmole*l**-1"),
       CaM = ScalarParam(0.000295573424135051, unit="mmole*l**-1"),
       Myo_c = ScalarParam(0.00192322252438022, unit="mmole*l**-1"),
       Myo_m = ScalarParam(0.137560495022823, unit="mmole*l**-1"),
       SRB = ScalarParam(0.00217360235649355, unit="mmole*l**-1"))

parameters("Cytosolic Ca Buffers",
           Bmax_TnClow = 70e-3,
           koff_tncl = 19.6e-3,
           kon_tncl = 32.7,

           Bmax_TnChigh = 140e-3,
           koff_tnchca = 0.032e-3,
           kon_tnchca = 2.37,
           koff_tnchmg = 3.33e-3,
           kon_tnchmg = 3e-3,

           Bmax_CaM = 24e-3,
           koff_cam = 238e-3,
           kon_cam = 34,

           Bmax_myosin = 140e-3,
           koff_myoca = 0.46e-3,
           kon_myoca = 13.8,
           koff_myomg = 0.057e-3,
           kon_myomg = 0.0157,

           Bmax_SR = 19*0.9e-3,
           koff_sr = 60e-3,
           kon_sr = 100,
           )

states("Junctional and SL Ca Buffers",
       SLL_j = ScalarParam(0.00740524521680039, unit="mmole*l**-1"),
       SLL_sl = ScalarParam(0.00990339304377132, unit="mmole*l**-1"),
       SLH_j = ScalarParam(0.0735890020284214, unit="mmole*l**-1"),
       SLH_sl = ScalarParam(0.114583623436917, unit="mmole*l**-1"))

parameters("Junctional and SL Ca Buffers",
           Bmax_SLlowsl0 = 37.4e-3,
           Bmax_SLlowj0 = 4.6e-4,
           koff_sll = 1300e-3,
           kon_sll = 100,

           Bmax_SLhighsl0 = 13.4e-3,
           Bmax_SLhighj0 = 1.65e-4,
           koff_slh = 30e-3,
           kon_slh = 100,
           )

states("SR Ca Concentrations",
       Csqn_b = ScalarParam(1.19723145924432, unit="mmole*l**-1"),
       Ca_sr = ScalarParam(0.554760499828172, unit="mmole*l**-1"))

parameters("SR Ca Concentrations",
           DcaJuncSL = 1.64e-6,
           DcaSLcyto = 1.22e-6,
           J_ca_juncsl = 8.2413e-13,
           J_ca_slmyo = 3.7243e-12,
           Bmax_Csqn0 = 140e-3,
           koff_csqn = 65,
           kon_csqn = 100,
           )

states("Na Concentrations",
       Na_j = ScalarParam(8.40537012592918, unit="mmole*l**-1"),
       Na_sl = ScalarParam(8.40491910001025, unit="mmole*l**-1"),
       Na_i = ScalarParam(8.40513364344858, unit="mmole*l**-1"))

parameters("Na Concentrations",
           Nao = 140,
           DnaJuncSL = 1.09e-5,
           DnaSLcyto = 1.79e-5,
           J_na_juncsl = 1.8313e-14,
           J_na_slmyo = 1.6386e-12,
           )

states("K Concentration",
       K_i = ScalarParam(120, unit="mmole*l**-1"))

parameters("K Concentration",
           Ko = 5.4
           )

states("Ca Concentrations",
       Ca_j = ScalarParam(0.000175882395147342, unit="mmole*l**-1"),
       Ca_sl = ScalarParam(0.000106779509977354, unit="mmole*l**-1"),
       Ca_i = ScalarParam(8.72509677797499e-5, unit="mmole*l**-1"))

parameters("Ca Concentrations",
           Cao = 1.8
           )

parameters("Cl Concentrations",
           Cli = 15,
           Clo = 150,
           )

parameters("Mg Concentrations",
           Mgi = 1,
           )

states("Membrane potential",
       V_m = ScalarParam(-81.4552030512661, unit="mV"))

parameters("Membrane potential",
           R = 8314,
           Frdy = 96485,
           Temp = 310,
           Cmem = 1.381e-10,
           stim_start = ScalarParam(1., unit="ms"),
           stim_period = ScalarParam(1000., unit="ms"),
           stim_duration = ScalarParam(1., unit="ms"),
           stim_amplitude = ScalarParam(0.0, unit="uA*uF**-1"))

component("Geometry")
Vcell = pi*cellRadius**2*cellLength*1e-15
Vmyo = 0.65*Vcell
Vsr = 0.035*Vcell
Vsl = 0.02*Vcell
Vjunc = 0.0539*0.01*Vcell
SAjunc = 20150*pi*2*junctionLength*junctionRadius
SAsl = pi*2*cellRadius*cellLength
Fsl = 1 - Fjunc
Fsl_CaL = 1 - Fjunc_CaL

component("Reversal potentials")
FoRT = Frdy/(R*Temp)
ena_junc = 1/FoRT*log(Nao/Na_j)
ena_sl = 1/FoRT*log(Nao/Na_sl)
ek = 1/FoRT*log(Ko/K_i)
eca_junc = 1/FoRT/2*log(Cao/Ca_j)
eca_sl = 1/FoRT/2*log(Cao/Ca_sl)
ecl = 1/FoRT*log(Cli/Clo)
Qpow = (Temp - 310)/10

component("I_Na")
mss = 1/(1 + exp(-(56.86 + V_m)/9.03))**2
taum = 0.1292*exp(-((V_m + 45.79)/15.54)**2) + 0.06487*exp(-((V_m - 4.823)/51.12)**2)
ah = Conditional(Ge(V_m, -40), 0, 0.057*exp(-(V_m + 80)/6.8))
bh = Conditional(Ge(V_m, -40), 0.77/(0.13*(1 + exp(-(V_m + 10.66)/11.1))), 2.7*exp(0.079*V_m) + 3.1e5*exp(0.3485*V_m))
tauh = 1/(ah + bh)
hss = 1/(1 + exp((V_m + 71.55)/7.43))**2
aj = Conditional(Ge(V_m, -40), 0, (-2.5428e4*exp(0.2444*V_m) - 6.948e-6*exp(-0.04391*V_m))*(V_m + 37.78)/(1 + exp(0.311*(V_m + 79.23))))
bj = Conditional(Ge(V_m, -40), 0.6*exp(0.057*V_m)/(1 + exp(-0.1*(V_m + 32))), 0.02424*exp(-0.01052*V_m)/(1 + exp(-0.1378*(V_m + 40.14))))
tauj = 1/(aj + bj)
jss = 1/(1 + exp((V_m + 71.55)/7.43))**2
dm_dt = (mss - m)/taum
dh_dt = (hss - h)/tauh
dj_dt = (jss - j)/tauj
I_Na_junc = Fjunc*GNa*m**3*h*j*(V_m - ena_junc)
I_Na_sl = Fsl*GNa*m**3*h*j*(V_m - ena_sl)
I_Na = I_Na_junc + I_Na_sl

component("I_NaBK")
I_nabk_junc = Fjunc*GNaB*(V_m - ena_junc)
I_nabk_sl = Fsl*GNaB*(V_m - ena_sl)
I_nabk = I_nabk_junc + I_nabk_sl

component("I_NaK")
sigma = (exp(Nao/67.3) - 1)/7
fnak = 1/(1 + 0.1245*exp(-0.1*V_m*FoRT) + 0.0365*sigma*exp(-V_m*FoRT))
I_nak_junc = Fjunc*IbarNaK*fnak*Ko/(1 + (KmNaip/Na_j)**4)/(Ko + KmKo)
I_nak_sl = Fsl*IbarNaK*fnak*Ko/(1 + (KmNaip/Na_sl)**4)/(Ko + KmKo)
I_nak = I_nak_junc + I_nak_sl

component("I_Kr")
gkr = 0.035*sqrt(Ko/5.4)
xrss = 1/(1 + exp(-(V_m + 10)/5))
tauxr = 550/(1 + exp((-22 - V_m)/9))*6/(1 + exp((V_m - -11)/9)) + 230/(1 + exp((V_m - -40)/20))
dx_kr_dt = (xrss - x_kr)/tauxr
rkr = 1/(1 + exp((V_m + 74)/24))
I_kr = gkr*x_kr*rkr*(V_m - ek)

component("I_Kp")
kp_kp = 1/(1 + exp(7.488 - V_m/5.98))
I_kp_junc = Fjunc*gkp*kp_kp*(V_m - ek)
I_kp_sl = Fsl*gkp*kp_kp*(V_m - ek)
I_kp = I_kp_junc + I_kp_sl

component("I_Ks")
eks = 1/FoRT*log((Ko + pNaK*Nao)/(K_i + pNaK*Na_i))
gks_junc = 0.0035
gks_sl = 0.0035
xsss = 1/(1 + exp(-(V_m + 3.8)/14.25))
tauxs = 990.1/(1 + exp(-(V_m + 2.436)/14.12))
dx_ks_dt = (xsss - x_ks)/tauxs
I_ks_junc = Fjunc*gks_junc*x_ks**2*(V_m - eks)
I_ks_sl = Fsl*gks_sl*x_ks**2*(V_m - eks)
I_ks = I_ks_junc + I_ks_sl

component("I_to")
GtoSlow = Conditional(Eq(epi, 1), 1*0.13*0.12, 0.13*0.3*0.964)
GtoFast = Conditional(Eq(epi, 1), 1*0.13*0.88, 0.13*0.3*0.036)
xtoss = 1/(1 + exp(-(V_m - 19)/13))
ytoss = 1/(1 + exp((V_m + 19.5)/5))
tauxtos = 9/(1 + exp((V_m + 3)/15)) + 0.5
tauytos = 800/(1 + exp((V_m + 60)/10)) + 30
dx_to_s_dt = (xtoss - x_to_s)/tauxtos
dy_to_s_dt = (ytoss - y_to_s)/tauytos
I_tos = GtoSlow*x_to_s*y_to_s*(V_m - ek)
tauxtof = 8.5*exp(-((V_m + 45)/50)**2) + 0.5
tauytof = 85*exp(-((V_m + 40)**2)/220) + 7
dx_to_f_dt = (xtoss - x_to_f)/tauxtof
dy_to_f_dt = (ytoss - y_to_f)/tauytof
I_tof = GtoFast*x_to_f*y_to_f*(V_m - ek)
I_to = I_tos + I_tof

component("I_Ki")
aki = 1.02/(1 + exp(0.2385*(V_m - ek - 59.215)))
bki = (0.49124*exp(0.08032*(V_m + 5.476 - ek)) + exp(0.06175*(V_m - ek - 594.31)))/(1 + exp(-0.5143*(V_m - ek + 4.753)))
kiss = aki/(aki + bki)
I_ki = 1*0.35*sqrt(Ko/5.4)*kiss*(V_m - ek)

component("I_ClCa")
I_ClCa_junc = Fjunc*GClCa/(1 + KdClCa/Ca_j)*(V_m - ecl)
I_ClCa_sl = Fsl*GClCa/(1 + KdClCa/Ca_sl)*(V_m - ecl)
I_ClCa = I_ClCa_junc + I_ClCa_sl
I_Clbk = GClB*(V_m - ecl)

component("I_Ca")
fss = 1/(1 + exp((V_m + 35)/9)) + 0.6/(1 + exp((50 - V_m)/20))
dss = 1/(1 + exp(-(V_m + 5)/6))
taud = 1*dss*(1 - exp(-(V_m + 5)/6))/(0.035*(V_m + 5))
tauf = 1/(0.0197*exp(-(0.0337*(V_m + 14.5))**2) + 0.02)
dd_dt = (dss - d)/taud
df_dt = (fss - f)/tauf
df_Ca_Bj_dt = 1.7*Ca_j/1*(1 - f_Ca_Bj) - 11.9e-3*f_Ca_Bj
df_Ca_Bsl_dt = 1.7*Ca_sl/1*(1 - f_Ca_Bsl) - 11.9e-3*f_Ca_Bsl
fcaCaMSL = 0
fcaCaj = 0
ibarca_j = pCa*4*V_m*Frdy*FoRT*(0.341*Ca_j*exp(2*V_m*FoRT) - 0.341*Cao)/(exp(2*V_m*FoRT) - 1)
ibarca_sl = pCa*4*V_m*Frdy*FoRT*(0.341*Ca_sl*exp(2*V_m*FoRT) - 0.341*Cao)/(exp(2*V_m*FoRT) - 1)
ibark = pK*V_m*Frdy*FoRT*(0.75*K_i*exp(V_m*FoRT) - 0.75*Ko)/(exp(V_m*FoRT) - 1)
ibarna_j = pNa*V_m*Frdy*FoRT*(0.75*Na_j*exp(V_m*FoRT) - 0.75*Nao)/(exp(V_m*FoRT) - 1)
ibarna_sl = pNa*V_m*Frdy*FoRT*(0.75*Na_sl*exp(V_m*FoRT) - 0.75*Nao)/(exp(V_m*FoRT) - 1)
I_Ca_junc = Fjunc_CaL*ibarca_j*d*f*(1 - f_Ca_Bj + fcaCaj)*Q10CaL**Qpow*0.45*1
I_Ca_sl = Fsl_CaL*ibarca_sl*d*f*(1 - f_Ca_Bsl + fcaCaMSL)*Q10CaL**Qpow*0.45*1
I_Ca = I_Ca_junc + I_Ca_sl
I_CaK = ibark*d*f*(Fjunc_CaL*(fcaCaj + 1 - f_Ca_Bj) + Fsl_CaL*(fcaCaMSL + 1 - f_Ca_Bsl))*Q10CaL**Qpow*0.45*1
I_CaNa_junc = Fjunc_CaL*ibarna_j*d*f*(1 - f_Ca_Bj + fcaCaj)*Q10CaL**Qpow*0.45*1
I_CaNa_sl = Fsl_CaL*ibarna_sl*d*f*(1 - f_Ca_Bsl + fcaCaMSL)*Q10CaL**Qpow*0.45*1
I_CaNa = I_CaNa_junc + I_CaNa_sl
I_Catot = I_Ca + I_CaK + I_CaNa

component("I_NCX")
Ka_junc = 1/(1 + (Kdact/Ca_j)**2)
Ka_sl = 1/(1 + (Kdact/Ca_sl)**2)
s1_junc = exp(nu*V_m*FoRT)*Na_j**3*Cao
s1_sl = exp(nu*V_m*FoRT)*Na_sl**3*Cao
s2_junc = exp((nu - 1)*V_m*FoRT)*Nao**3*Ca_j
s3_junc = KmCai*Nao**3*(1 + (Na_j/KmNai)**3) + KmNao**3*Ca_j*(1 + Ca_j/KmCai) + KmCao*Na_j**3 + Na_j**3*Cao + Nao**3*Ca_j
s2_sl = exp((nu - 1)*V_m*FoRT)*Nao**3*Ca_sl
s3_sl = KmCai*Nao**3*(1 + (Na_sl/KmNai)**3) + KmNao**3*Ca_sl*(1 + Ca_sl/KmCai) + KmCao*Na_sl**3 + Na_sl**3*Cao + Nao**3*Ca_sl
I_ncx_junc = Fjunc*IbarNCX*Q10NCX**Qpow*Ka_junc*(s1_junc - s2_junc)/s3_junc/(1 + ksat*exp((nu - 1)*V_m*FoRT))
I_ncx_sl = Fsl*IbarNCX*Q10NCX**Qpow*Ka_sl*(s1_sl - s2_sl)/s3_sl/(1 + ksat*exp((nu - 1)*V_m*FoRT))
I_ncx = I_ncx_junc + I_ncx_sl

component("I_PCa")
I_pca_junc = Fjunc*Q10SLCaP**Qpow*IbarSLCaP*Ca_j**1.6/(KmPCa**1.6 + Ca_j**1.6)
I_pca_sl = Fsl*Q10SLCaP**Qpow*IbarSLCaP*Ca_sl**1.6/(KmPCa**1.6 + Ca_sl**1.6)
I_pca = I_pca_junc + I_pca_sl

component("I_CaBK")
I_cabk_junc = Fjunc*GCaB*(V_m - eca_junc)
I_cabk_sl = Fsl*GCaB*(V_m - eca_sl)
I_cabk = I_cabk_junc + I_cabk_sl

component("SR Fluxes")
kCaSR = MaxSR - (MaxSR - MinSR)/(1 + (ec50SR/Ca_sr)**2.5)
koSRCa = koCa/kCaSR
kiSRCa = kiCa*kCaSR
RI = 1 - Ry_Rr - Ry_Ro - Ry_Ri
dRy_Rr_dt = kim*RI - kiSRCa*Ca_j*Ry_Rr - (koSRCa*Ca_j**2*Ry_Rr - kom*Ry_Ro)
dRy_Ro_dt = koSRCa*Ca_j**2*Ry_Rr - kom*Ry_Ro - (kiSRCa*Ca_j*Ry_Ro - kim*Ry_Ri)
dRy_Ri_dt = kiSRCa*Ca_j*Ry_Ro - kim*Ry_Ri - (kom*Ry_Ri - koSRCa*Ca_j**2*RI)
J_SRCarel = ks*Ry_Ro/1*(Ca_sr - Ca_j)
J_serca = Q10SRCaP**Qpow*Vmax_SRCaP*((Ca_i/Kmf)**hillSRCaP - (Ca_sr/Kmr)**hillSRCaP)/(1 + (Ca_i/Kmf)**hillSRCaP + (Ca_sr/Kmr)**hillSRCaP)
J_SRleak = 5.348e-6*(Ca_sr - Ca_j)

component("Na Buffers")
dNa_Bj_dt = kon_na*Na_j*(Bmax_Naj - Na_Bj) - koff_na*Na_Bj
dNa_Bsl_dt = kon_na*Na_sl*(Bmax_Nasl - Na_Bsl) - koff_na*Na_Bsl

component("Cytosolic Ca Buffers")
dTn_CL_dt = kon_tncl*Ca_i*(Bmax_TnClow - Tn_CL) - koff_tncl*Tn_CL
dTn_CHc_dt = kon_tnchca*Ca_i*(Bmax_TnChigh - Tn_CHc - Tn_CHm) - koff_tnchca*Tn_CHc
dTn_CHm_dt = kon_tnchmg*Mgi*(Bmax_TnChigh - Tn_CHc - Tn_CHm) - koff_tnchmg*Tn_CHm
dCaM_dt = kon_cam*Ca_i*(Bmax_CaM - CaM) - koff_cam*CaM
dMyo_c_dt = kon_myoca*Ca_i*(Bmax_myosin - Myo_c - Myo_m) - koff_myoca*Myo_c
dMyo_m_dt = kon_myomg*Mgi*(Bmax_myosin - Myo_c - Myo_m) - koff_myomg*Myo_m
dSRB_dt = kon_sr*Ca_i*(Bmax_SR - SRB) - koff_sr*SRB
J_CaB_cytosol = kon_tncl*Ca_i*(Bmax_TnClow - Tn_CL) - koff_tncl*Tn_CL + kon_tnchca*Ca_i*(Bmax_TnChigh - Tn_CHc - Tn_CHm) - koff_tnchca*Tn_CHc + kon_tnchmg*Mgi*(Bmax_TnChigh - Tn_CHc - Tn_CHm) - koff_tnchmg*Tn_CHm + kon_cam*Ca_i*(Bmax_CaM - CaM) - koff_cam*CaM + kon_myoca*Ca_i*(Bmax_myosin - Myo_c - Myo_m) - koff_myoca*Myo_c + kon_myomg*Mgi*(Bmax_myosin - Myo_c - Myo_m) - koff_myomg*Myo_m + kon_sr*Ca_i*(Bmax_SR - SRB) - koff_sr*SRB

component("Junctional and SL Ca Buffers")
Bmax_SLlowsl = Bmax_SLlowsl0*Vmyo/Vsl
Bmax_SLlowj = Bmax_SLlowj0*Vmyo/Vjunc
Bmax_SLhighsl = Bmax_SLhighsl0*Vmyo/Vsl
Bmax_SLhighj = Bmax_SLhighj0*Vmyo/Vjunc
dSLL_j_dt = kon_sll*Ca_j*(Bmax_SLlowj - SLL_j) - koff_sll*SLL_j
dSLL_sl_dt = kon_sll*Ca_sl*(Bmax_SLlowsl - SLL_sl) - koff_sll*SLL_sl
dSLH_j_dt = kon_slh*Ca_j*(Bmax_SLhighj - SLH_j) - koff_slh*SLH_j
dSLH_sl_dt = kon_slh*Ca_sl*(Bmax_SLhighsl - SLH_sl) - koff_slh*SLH_sl
J_CaB_junction = kon_sll*Ca_j*(Bmax_SLlowj - SLL_j) - koff_sll*SLL_j + kon_slh*Ca_j*(Bmax_SLhighj - SLH_j) - koff_slh*SLH_j
J_CaB_sl = kon_sll*Ca_sl*(Bmax_SLlowsl - SLL_sl) - koff_sll*SLL_sl + kon_slh*Ca_sl*(Bmax_SLhighsl - SLH_sl) - koff_slh*SLH_sl

component("SR Ca Concentrations")
Bmax_Csqn = Bmax_Csqn0*Vmyo/Vsr
dCsqn_b_dt = kon_csqn*Ca_sr*(Bmax_Csqn - Csqn_b) - koff_csqn*Csqn_b
dCa_sr_dt = J_serca - (J_SRleak*Vmyo/Vsr + J_SRCarel) - (kon_csqn*Ca_sr*(Bmax_Csqn - Csqn_b) - koff_csqn*Csqn_b)

component("Na Concentrations")
I_Na_tot_junc = I_Na_junc + I_nabk_junc + 3*I_ncx_junc + 3*I_nak_junc + I_CaNa_junc
I_Na_tot_sl = I_Na_sl + I_nabk_sl + 3*I_ncx_sl + 3*I_nak_sl + I_CaNa_sl
I_Na_tot_sl2 = 3*I_ncx_sl + 3*I_nak_sl + I_CaNa_sl
I_Na_tot_junc2 = 3*I_ncx_junc + 3*I_nak_junc + I_CaNa_junc
dNa_j_dt = -I_Na_tot_junc*Cmem/(Vjunc*Frdy) + J_na_juncsl/Vjunc*(Na_sl - Na_j) - dNa_Bj_dt
dNa_sl_dt = -I_Na_tot_sl*Cmem/(Vsl*Frdy) + J_na_juncsl/Vsl*(Na_j - Na_sl) + J_na_slmyo/Vsl*(Na_i - Na_sl) - dNa_Bsl_dt
dNa_i_dt = J_na_slmyo/Vmyo*(Na_sl - Na_i)

component("K Concentration")
I_K_tot = I_to + I_kr + I_ks + I_ki - 2*I_nak + I_CaK + I_kp
dK_i_dt = 0

component("Ca Concentrations")
I_Ca_tot_junc = I_Ca_junc + I_cabk_junc + I_pca_junc - 2*I_ncx_junc
I_Ca_tot_sl = I_Ca_sl + I_cabk_sl + I_pca_sl - 2*I_ncx_sl
dCa_j_dt = -I_Ca_tot_junc*Cmem/(Vjunc*2*Frdy) + J_ca_juncsl/Vjunc*(Ca_sl - Ca_j) - J_CaB_junction + J_SRCarel*Vsr/Vjunc + J_SRleak*Vmyo/Vjunc
dCa_sl_dt = -I_Ca_tot_sl*Cmem/(Vsl*2*Frdy) + J_ca_juncsl/Vsl*(Ca_j - Ca_sl) + J_ca_slmyo/Vsl*(Ca_i - Ca_sl) - J_CaB_sl
dCa_i_dt = -J_serca*Vsr/Vmyo - J_CaB_cytosol + J_ca_slmyo/Vmyo*(Ca_sl - Ca_i)

component("Membrane potential")
i_Stim = 0.0#Conditional(And(Ge(time - floor(time/stim_period)*stim_period, stim_start), Le(time - floor(time/stim_period)*stim_period, stim_start + stim_duration), ), -stim_amplitude, 0)
I_Na_tot = I_Na_tot_junc + I_Na_tot_sl
I_Cl_tot = I_ClCa + I_Clbk
I_Ca_tot = I_Ca_tot_junc + I_Ca_tot_sl
I_tot = I_Na_tot + I_Cl_tot + I_Ca_tot + I_K_tot
dV_m_dt = -(I_tot + i_Stim)
